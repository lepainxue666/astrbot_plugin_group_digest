# AstrBot 群重要消息汇总插件

自动监听群聊重要消息，智能过滤噪音，定时汇总推送，支持主动查询。

## 功能特性

- 智能识别重要消息
  - `@全体成员` 消息
  - `@你` 的消息
  - 包含重要关键词的消息（重要、紧急、通知、公告、会议、截止等）
  - 长消息（超过50字符）
- 自动过滤骚扰消息
  - 红包、砍价、投票、拼多多等营销消息
- 每日定时私聊汇总
  - 可配置汇总时间
  - 自动发送当日重要消息
- 主动查询功能
  - 支持查询最近N天的重要消息
  - 中文指令支持
- 数据持久化
  - 使用KV存储保存消息记录
  - 最多保存1000条消息

## 安装方法

### 方法1：通过AstrBot插件市场安装

1. 打开AstrBot WebUI
2. 进入插件管理
3. 点击"从GitHub导入"
4. 输入仓库地址：`https://github.com/lepainxue666/astrbot_plugin_group_digest`
5. 点击安装

### 方法2：手动安装

1. 克隆仓库到AstrBot的插件目录：
```bash
cd AstrBot/data/plugins
git clone https://github.com/lepainxue666/astrbot_plugin_group_digest
```

2. 在AstrBot WebUI中重载插件

## 使用方法

### 首次使用

1. 将机器人加入需要监听的群聊
2. 在群里发送任意消息，插件会自动识别你的QQ号
3. 插件开始监听群聊消息

### 配置插件

在AstrBot WebUI的插件配置中可以调整以下选项：

- **启用每日自动汇总**：是否启用定时推送（默认：启用）
- **每日汇总时间**：设置推送时间，格式：HH:MM（默认：21:00）
- **最大查询天数**：设置最多查询多少天的消息，范围：1-30天（默认：7天）
- **接收汇总的用户QQ号**：填写你的QQ号，留空则自动识别

### 指令列表

所有指令都需要在**私聊**中使用：

| 指令 | 说明 | 示例 |
|------|------|------|
| `/digest recent [天数]` | 查询最近N天的重要消息 | `/digest recent 3` |
| `最近重要消息 [天数]` | 查询最近N天的重要消息（中文） | `最近重要消息 3` |
| `/digest setuser` | 设置接收汇总的用户ID | `/digest setuser` |
| `/digest clear` | 清空所有记录的消息 | `/digest clear` |
| `/digest status` | 查看插件状态 | `/digest status` |

### 使用示例

1. **查询今日重要消息**
   ```
   最近重要消息
   ```

2. **查询最近3天的重要消息**
   ```
   最近重要消息 3
   ```

3. **查看插件状态**
   ```
   /digest status
   ```

## 重要消息识别规则

### 会被记录的消息

- `@全体成员` 的消息
- `@你` 的消息
- 包含以下关键词的消息：
  - 重要、紧急、通知、公告、会议、截止、deadline、必须、务必
- 长度超过50字符的消息

### 会被过滤的消息

- 包含以下关键词的消息：
  - 红包、砍价、投票、帮忙点、拼多多、助力、集赞、转发、抽奖、免费领
- 长度小于2字符的消息

## 汇总消息格式

```
📊 今日重要消息汇总
========================================

📢 群123456789
------------------------------
14:30 [@全体] 张三: 明天上午9点开会，请大家准时参加
15:45 李四: 重要通知：本周五截止提交作业
16:20 [@我] 王五: 你好，请问明天的会议需要准备什么材料？

========================================
共 3 条重要消息
```

## 配置说明

### _conf_schema.json

插件配置文件定义了以下配置项：

```json
{
  "enable_daily_digest": {
    "description": "是否每天定时向好友私聊发送重要消息汇总",
    "type": "boolean",
    "default": true
  },
  "daily_digest_time": {
    "description": "每日自动汇总发送的时间（24小时制，HH:MM）",
    "type": "string",
    "default": "21:00"
  },
  "max_query_days": {
    "description": "主动查询“最近重要消息 X天”时允许的最大天数",
    "type": "int",
    "default": 7
  },
  "user_id": {
    "description": "接收汇总的用户QQ号（留空则自动识别第一个在群里说话的用户）",
    "type": "string",
    "default": ""
  }
}
```

## 使用场景

- **学习群**：自动记录课程通知、作业截止时间等重要信息
- **实验室群**：汇总会议通知、项目进度更新等
- **项目群**：防止错过重要的公告和截止日期
- **工作群**：自动整理重要工作通知

## 技术细节

- **AstrBot版本要求**：>= 4.10.6
- **数据存储**：使用AstrBot提供的KV存储
- **消息限制**：最多保存1000条消息，超出后自动删除旧消息
- **定时任务**：使用asyncio实现异步定时任务

## 开发者

- 作者：xueLepain
- 仓库：https://github.com/lepainxue666/astrbot_plugin_group_digest
- 许可证：MIT

## 更新日志

### v0.1.0 (2024-01-08)

- 初始版本发布
- 实现基本的消息监听和识别功能
- 支持定时每日汇总
- 支持主动查询功能
- 支持配置文件管理

## 常见问题

### Q: 如何设置接收汇总的用户？

A: 有三种方式：
1. 在插件配置中填写你的QQ号
2. 在群里发送任意消息，插件会自动识别
3. 在私聊中发送 `/digest setuser` 命令

### Q: 为什么有些消息没有被记录？

A: 插件只会记录符合重要消息规则的消息，包括@全体、@你、包含重要关键词或长消息。普通聊天和骚扰消息会被过滤。

### Q: 每日汇总什么时候发送？

A: 默认在每天21:00发送，可以在插件配置中修改时间。

### Q: 如何清空所有记录的消息？

A: 在私聊中发送 `/digest clear` 命令。

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request！
